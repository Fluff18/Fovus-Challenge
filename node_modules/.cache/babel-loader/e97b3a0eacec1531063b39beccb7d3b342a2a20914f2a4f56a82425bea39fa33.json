{"ast":null,"code":"var AWS = require('../core');\nvar v4Credentials = require('../signers/v4_credentials');\n\n// Pull in managed upload extension\nrequire('../s3/managed_upload');\n\n/**\n * @api private\n */\nvar operationsWith200StatusCodeError = {\n  'completeMultipartUpload': true,\n  'copyObject': true,\n  'uploadPartCopy': true\n};\n\n/**\n * @api private\n */\nvar regionRedirectErrorCodes = ['AuthorizationHeaderMalformed',\n// non-head operations on virtual-hosted global bucket endpoints\n'BadRequest',\n// head operations on virtual-hosted global bucket endpoints\n'PermanentRedirect',\n// non-head operations on path-style or regional endpoints\n301 // head operations on path-style or regional endpoints\n];\n\nAWS.util.update(AWS.S3.prototype, {\n  /**\n   * @api private\n   */\n  getSignerClass: function getSignerClass(request) {\n    var defaultApiVersion = this.api.signatureVersion;\n    var userDefinedVersion = this._originalConfig ? this._originalConfig.signatureVersion : null;\n    var regionDefinedVersion = this.config.signatureVersion;\n    var isPresigned = request ? request.isPresigned() : false;\n    /*\n      1) User defined version specified:\n        a) always return user defined version\n      2) No user defined version specified:\n        a) default to lowest version the region supports\n    */\n    if (userDefinedVersion) {\n      userDefinedVersion = userDefinedVersion === 'v2' ? 's3' : userDefinedVersion;\n      return AWS.Signers.RequestSigner.getVersion(userDefinedVersion);\n    }\n    if (regionDefinedVersion) {\n      defaultApiVersion = regionDefinedVersion;\n    }\n    return AWS.Signers.RequestSigner.getVersion(defaultApiVersion);\n  },\n  /**\n   * @api private\n   */\n  validateService: function validateService() {\n    var msg;\n    var messages = [];\n\n    // default to us-east-1 when no region is provided\n    if (!this.config.region) this.config.region = 'us-east-1';\n    if (!this.config.endpoint && this.config.s3BucketEndpoint) {\n      messages.push('An endpoint must be provided when configuring ' + '`s3BucketEndpoint` to true.');\n    }\n    if (messages.length === 1) {\n      msg = messages[0];\n    } else if (messages.length > 1) {\n      msg = 'Multiple configuration errors:\\n' + messages.join('\\n');\n    }\n    if (msg) {\n      throw AWS.util.error(new Error(), {\n        name: 'InvalidEndpoint',\n        message: msg\n      });\n    }\n  },\n  /**\n   * @api private\n   */\n  shouldDisableBodySigning: function shouldDisableBodySigning(request) {\n    var signerClass = this.getSignerClass();\n    if (this.config.s3DisableBodySigning === true && signerClass === AWS.Signers.V4 && request.httpRequest.endpoint.protocol === 'https:') {\n      return true;\n    }\n    return false;\n  },\n  /**\n   * @api private\n   */\n  setupRequestListeners: function setupRequestListeners(request) {\n    request.addListener('validate', this.validateScheme);\n    request.addListener('validate', this.validateBucketEndpoint);\n    request.addListener('validate', this.correctBucketRegionFromCache);\n    request.addListener('build', this.addContentType);\n    request.addListener('build', this.populateURI);\n    request.addListener('build', this.computeContentMd5);\n    request.addListener('build', this.computeSseCustomerKeyMd5);\n    request.addListener('afterBuild', this.addExpect100Continue);\n    request.removeListener('validate', AWS.EventListeners.Core.VALIDATE_REGION);\n    request.addListener('extractError', this.extractError);\n    request.onAsync('extractError', this.requestBucketRegion);\n    request.addListener('extractData', this.extractData);\n    request.addListener('extractData', AWS.util.hoistPayloadMember);\n    request.addListener('beforePresign', this.prepareSignedUrl);\n    if (AWS.util.isBrowser()) {\n      request.onAsync('retry', this.reqRegionForNetworkingError);\n    }\n    if (this.shouldDisableBodySigning(request)) {\n      request.removeListener('afterBuild', AWS.EventListeners.Core.COMPUTE_SHA256);\n      request.addListener('afterBuild', this.disableBodySigning);\n    }\n  },\n  /**\n   * @api private\n   */\n  validateScheme: function (req) {\n    var params = req.params,\n      scheme = req.httpRequest.endpoint.protocol,\n      sensitive = params.SSECustomerKey || params.CopySourceSSECustomerKey;\n    if (sensitive && scheme !== 'https:') {\n      var msg = 'Cannot send SSE keys over HTTP. Set \\'sslEnabled\\'' + 'to \\'true\\' in your configuration';\n      throw AWS.util.error(new Error(), {\n        code: 'ConfigError',\n        message: msg\n      });\n    }\n  },\n  /**\n   * @api private\n   */\n  validateBucketEndpoint: function (req) {\n    if (!req.params.Bucket && req.service.config.s3BucketEndpoint) {\n      var msg = 'Cannot send requests to root API with `s3BucketEndpoint` set.';\n      throw AWS.util.error(new Error(), {\n        code: 'ConfigError',\n        message: msg\n      });\n    }\n  },\n  /**\n   * @api private\n   */\n  isValidAccelerateOperation: function isValidAccelerateOperation(operation) {\n    var invalidOperations = ['createBucket', 'deleteBucket', 'listBuckets'];\n    return invalidOperations.indexOf(operation) === -1;\n  },\n  /**\n   * S3 prefers dns-compatible bucket names to be moved from the uri path\n   * to the hostname as a sub-domain.  This is not possible, even for dns-compat\n   * buckets when using SSL and the bucket name contains a dot ('.').  The\n   * ssl wildcard certificate is only 1-level deep.\n   *\n   * @api private\n   */\n  populateURI: function populateURI(req) {\n    var httpRequest = req.httpRequest;\n    var b = req.params.Bucket;\n    var service = req.service;\n    var endpoint = httpRequest.endpoint;\n    if (b) {\n      if (!service.pathStyleBucketName(b)) {\n        if (service.config.useAccelerateEndpoint && service.isValidAccelerateOperation(req.operation)) {\n          if (service.config.useDualstack) {\n            endpoint.hostname = b + '.s3-accelerate.dualstack.amazonaws.com';\n          } else {\n            endpoint.hostname = b + '.s3-accelerate.amazonaws.com';\n          }\n        } else if (!service.config.s3BucketEndpoint) {\n          endpoint.hostname = b + '.' + endpoint.hostname;\n        }\n        var port = endpoint.port;\n        if (port !== 80 && port !== 443) {\n          endpoint.host = endpoint.hostname + ':' + endpoint.port;\n        } else {\n          endpoint.host = endpoint.hostname;\n        }\n        httpRequest.virtualHostedBucket = b; // needed for signing the request\n        service.removeVirtualHostedBucketFromPath(req);\n      }\n    }\n  },\n  /**\n   * Takes the bucket name out of the path if bucket is virtual-hosted\n   *\n   * @api private\n   */\n  removeVirtualHostedBucketFromPath: function removeVirtualHostedBucketFromPath(req) {\n    var httpRequest = req.httpRequest;\n    var bucket = httpRequest.virtualHostedBucket;\n    if (bucket && httpRequest.path) {\n      httpRequest.path = httpRequest.path.replace(new RegExp('/' + bucket), '');\n      if (httpRequest.path[0] !== '/') {\n        httpRequest.path = '/' + httpRequest.path;\n      }\n    }\n  },\n  /**\n   * Adds Expect: 100-continue header if payload is greater-or-equal 1MB\n   * @api private\n   */\n  addExpect100Continue: function addExpect100Continue(req) {\n    var len = req.httpRequest.headers['Content-Length'];\n    if (AWS.util.isNode() && len >= 1024 * 1024) {\n      req.httpRequest.headers['Expect'] = '100-continue';\n    }\n  },\n  /**\n   * Adds a default content type if none is supplied.\n   *\n   * @api private\n   */\n  addContentType: function addContentType(req) {\n    var httpRequest = req.httpRequest;\n    if (httpRequest.method === 'GET' || httpRequest.method === 'HEAD') {\n      // Content-Type is not set in GET/HEAD requests\n      delete httpRequest.headers['Content-Type'];\n      return;\n    }\n    if (!httpRequest.headers['Content-Type']) {\n      // always have a Content-Type\n      httpRequest.headers['Content-Type'] = 'application/octet-stream';\n    }\n    var contentType = httpRequest.headers['Content-Type'];\n    if (AWS.util.isBrowser()) {\n      if (typeof httpRequest.body === 'string' && !contentType.match(/;\\s*charset=/)) {\n        var charset = '; charset=UTF-8';\n        httpRequest.headers['Content-Type'] += charset;\n      } else {\n        var replaceFn = function (_, prefix, charsetName) {\n          return prefix + charsetName.toUpperCase();\n        };\n        httpRequest.headers['Content-Type'] = contentType.replace(/(;\\s*charset=)(.+)$/, replaceFn);\n      }\n    }\n  },\n  /**\n   * @api private\n   */\n  computableChecksumOperations: {\n    putBucketCors: true,\n    putBucketLifecycle: true,\n    putBucketLifecycleConfiguration: true,\n    putBucketTagging: true,\n    deleteObjects: true,\n    putBucketReplication: true\n  },\n  /**\n   * Checks whether checksums should be computed for the request.\n   * If the request requires checksums to be computed, this will always\n   * return true, otherwise it depends on whether {AWS.Config.computeChecksums}\n   * is set.\n   *\n   * @param req [AWS.Request] the request to check against\n   * @return [Boolean] whether to compute checksums for a request.\n   * @api private\n   */\n  willComputeChecksums: function willComputeChecksums(req) {\n    if (this.computableChecksumOperations[req.operation]) return true;\n    if (!this.config.computeChecksums) return false;\n\n    // TODO: compute checksums for Stream objects\n    if (!AWS.util.Buffer.isBuffer(req.httpRequest.body) && typeof req.httpRequest.body !== 'string') {\n      return false;\n    }\n    var rules = req.service.api.operations[req.operation].input.members;\n\n    // Sha256 signing disabled, and not a presigned url\n    if (req.service.shouldDisableBodySigning(req) && !Object.prototype.hasOwnProperty.call(req.httpRequest.headers, 'presigned-expires')) {\n      if (rules.ContentMD5 && !req.params.ContentMD5) {\n        return true;\n      }\n    }\n\n    // V4 signer uses SHA256 signatures so only compute MD5 if it is required\n    if (req.service.getSignerClass(req) === AWS.Signers.V4) {\n      if (rules.ContentMD5 && !rules.ContentMD5.required) return false;\n    }\n    if (rules.ContentMD5 && !req.params.ContentMD5) return true;\n  },\n  /**\n   * A listener that computes the Content-MD5 and sets it in the header.\n   * @see AWS.S3.willComputeChecksums\n   * @api private\n   */\n  computeContentMd5: function computeContentMd5(req) {\n    if (req.service.willComputeChecksums(req)) {\n      var md5 = AWS.util.crypto.md5(req.httpRequest.body, 'base64');\n      req.httpRequest.headers['Content-MD5'] = md5;\n    }\n  },\n  /**\n   * @api private\n   */\n  computeSseCustomerKeyMd5: function computeSseCustomerKeyMd5(req) {\n    var keys = {\n      SSECustomerKey: 'x-amz-server-side-encryption-customer-key-MD5',\n      CopySourceSSECustomerKey: 'x-amz-copy-source-server-side-encryption-customer-key-MD5'\n    };\n    AWS.util.each(keys, function (key, header) {\n      if (req.params[key]) {\n        var value = AWS.util.crypto.md5(req.params[key], 'base64');\n        req.httpRequest.headers[header] = value;\n      }\n    });\n  },\n  /**\n   * Returns true if the bucket name should be left in the URI path for\n   * a request to S3.  This function takes into account the current\n   * endpoint protocol (e.g. http or https).\n   *\n   * @api private\n   */\n  pathStyleBucketName: function pathStyleBucketName(bucketName) {\n    // user can force path style requests via the configuration\n    if (this.config.s3ForcePathStyle) return true;\n    if (this.config.s3BucketEndpoint) return false;\n    if (this.dnsCompatibleBucketName(bucketName)) {\n      return this.config.sslEnabled && bucketName.match(/\\./) ? true : false;\n    } else {\n      return true; // not dns compatible names must always use path style\n    }\n  },\n\n  /**\n   * Returns true if the bucket name is DNS compatible.  Buckets created\n   * outside of the classic region MUST be DNS compatible.\n   *\n   * @api private\n   */\n  dnsCompatibleBucketName: function dnsCompatibleBucketName(bucketName) {\n    var b = bucketName;\n    var domain = new RegExp(/^[a-z0-9][a-z0-9\\.\\-]{1,61}[a-z0-9]$/);\n    var ipAddress = new RegExp(/(\\d+\\.){3}\\d+/);\n    var dots = new RegExp(/\\.\\./);\n    return b.match(domain) && !b.match(ipAddress) && !b.match(dots) ? true : false;\n  },\n  /**\n   * @return [Boolean] whether response contains an error\n   * @api private\n   */\n  successfulResponse: function successfulResponse(resp) {\n    var req = resp.request;\n    var httpResponse = resp.httpResponse;\n    if (operationsWith200StatusCodeError[req.operation] && httpResponse.body.toString().match('<Error>')) {\n      return false;\n    } else {\n      return httpResponse.statusCode < 300;\n    }\n  },\n  /**\n   * @return [Boolean] whether the error can be retried\n   * @api private\n   */\n  retryableError: function retryableError(error, request) {\n    if (operationsWith200StatusCodeError[request.operation] && error.statusCode === 200) {\n      return true;\n    } else if (request._requestRegionForBucket && request.service.bucketRegionCache[request._requestRegionForBucket]) {\n      return false;\n    } else if (error && error.code === 'RequestTimeout') {\n      return true;\n    } else if (error && regionRedirectErrorCodes.indexOf(error.code) != -1 && error.region && error.region != request.httpRequest.region) {\n      request.httpRequest.region = error.region;\n      if (error.statusCode === 301) {\n        request.service.updateReqBucketRegion(request);\n      }\n      return true;\n    } else {\n      var _super = AWS.Service.prototype.retryableError;\n      return _super.call(this, error, request);\n    }\n  },\n  /**\n   * Updates httpRequest with region. If region is not provided, then\n   * the httpRequest will be updated based on httpRequest.region\n   *\n   * @api private\n   */\n  updateReqBucketRegion: function updateReqBucketRegion(request, region) {\n    var httpRequest = request.httpRequest;\n    if (typeof region === 'string' && region.length) {\n      httpRequest.region = region;\n    }\n    if (!httpRequest.endpoint.host.match(/s3(?!-accelerate).*\\.amazonaws\\.com$/)) {\n      return;\n    }\n    var service = request.service;\n    var s3Config = service.config;\n    var s3BucketEndpoint = s3Config.s3BucketEndpoint;\n    if (s3BucketEndpoint) {\n      delete s3Config.s3BucketEndpoint;\n    }\n    var newConfig = AWS.util.copy(s3Config);\n    delete newConfig.endpoint;\n    newConfig.region = httpRequest.region;\n    httpRequest.endpoint = new AWS.S3(newConfig).endpoint;\n    service.populateURI(request);\n    s3Config.s3BucketEndpoint = s3BucketEndpoint;\n    httpRequest.headers.Host = httpRequest.endpoint.host;\n    if (request._asm.currentState === 'validate') {\n      request.removeListener('build', service.populateURI);\n      request.addListener('build', service.removeVirtualHostedBucketFromPath);\n    }\n  },\n  /**\n   * Provides a specialized parser for getBucketLocation -- all other\n   * operations are parsed by the super class.\n   *\n   * @api private\n   */\n  extractData: function extractData(resp) {\n    var req = resp.request;\n    if (req.operation === 'getBucketLocation') {\n      var match = resp.httpResponse.body.toString().match(/>(.+)<\\/Location/);\n      delete resp.data['_'];\n      if (match) {\n        resp.data.LocationConstraint = match[1];\n      } else {\n        resp.data.LocationConstraint = '';\n      }\n    }\n    var bucket = req.params.Bucket || null;\n    if (req.operation === 'deleteBucket' && typeof bucket === 'string' && !resp.error) {\n      req.service.clearBucketRegionCache(bucket);\n    } else {\n      var headers = resp.httpResponse.headers || {};\n      var region = headers['x-amz-bucket-region'] || null;\n      if (!region && req.operation === 'createBucket' && !resp.error) {\n        var createBucketConfiguration = req.params.CreateBucketConfiguration;\n        if (!createBucketConfiguration) {\n          region = 'us-east-1';\n        } else if (createBucketConfiguration.LocationConstraint === 'EU') {\n          region = 'eu-west-1';\n        } else {\n          region = createBucketConfiguration.LocationConstraint;\n        }\n      }\n      if (region) {\n        if (bucket && region !== req.service.bucketRegionCache[bucket]) {\n          req.service.bucketRegionCache[bucket] = region;\n        }\n      }\n    }\n    req.service.extractRequestIds(resp);\n  },\n  /**\n   * Extracts an error object from the http response.\n   *\n   * @api private\n   */\n  extractError: function extractError(resp) {\n    var codes = {\n      304: 'NotModified',\n      403: 'Forbidden',\n      400: 'BadRequest',\n      404: 'NotFound'\n    };\n    var req = resp.request;\n    var code = resp.httpResponse.statusCode;\n    var body = resp.httpResponse.body || '';\n    var headers = resp.httpResponse.headers || {};\n    var region = headers['x-amz-bucket-region'] || null;\n    var bucket = req.params.Bucket || null;\n    var bucketRegionCache = req.service.bucketRegionCache;\n    if (region && bucket && region !== bucketRegionCache[bucket]) {\n      bucketRegionCache[bucket] = region;\n    }\n    var cachedRegion;\n    if (codes[code] && body.length === 0) {\n      if (bucket && !region) {\n        cachedRegion = bucketRegionCache[bucket] || null;\n        if (cachedRegion !== req.httpRequest.region) {\n          region = cachedRegion;\n        }\n      }\n      resp.error = AWS.util.error(new Error(), {\n        code: codes[code],\n        message: null,\n        region: region\n      });\n    } else {\n      var data = new AWS.XML.Parser().parse(body.toString());\n      if (data.Region && !region) {\n        region = data.Region;\n        if (bucket && region !== bucketRegionCache[bucket]) {\n          bucketRegionCache[bucket] = region;\n        }\n      } else if (bucket && !region && !data.Region) {\n        cachedRegion = bucketRegionCache[bucket] || null;\n        if (cachedRegion !== req.httpRequest.region) {\n          region = cachedRegion;\n        }\n      }\n      resp.error = AWS.util.error(new Error(), {\n        code: data.Code || code,\n        message: data.Message || null,\n        region: region\n      });\n    }\n    req.service.extractRequestIds(resp);\n  },\n  /**\n   * If region was not obtained synchronously, then send async request\n   * to get bucket region for errors resulting from wrong region.\n   *\n   * @api private\n   */\n  requestBucketRegion: function requestBucketRegion(resp, done) {\n    var error = resp.error;\n    var req = resp.request;\n    var bucket = req.params.Bucket || null;\n    if (!error || !bucket || error.region || req.operation === 'listObjects' || AWS.util.isNode() && req.operation === 'headBucket' || error.statusCode === 400 && req.operation !== 'headObject' || regionRedirectErrorCodes.indexOf(error.code) === -1) {\n      return done();\n    }\n    var reqOperation = AWS.util.isNode() ? 'headBucket' : 'listObjects';\n    var reqParams = {\n      Bucket: bucket\n    };\n    if (reqOperation === 'listObjects') reqParams.MaxKeys = 0;\n    var regionReq = req.service[reqOperation](reqParams);\n    regionReq._requestRegionForBucket = bucket;\n    regionReq.send(function () {\n      var region = req.service.bucketRegionCache[bucket] || null;\n      error.region = region;\n      done();\n    });\n  },\n  /**\n  * For browser only. If NetworkingError received, will attempt to obtain\n  * the bucket region.\n  *\n  * @api private\n  */\n  reqRegionForNetworkingError: function reqRegionForNetworkingError(resp, done) {\n    if (!AWS.util.isBrowser()) {\n      return done();\n    }\n    var error = resp.error;\n    var request = resp.request;\n    var bucket = request.params.Bucket;\n    if (!error || error.code !== 'NetworkingError' || !bucket || request.httpRequest.region === 'us-east-1') {\n      return done();\n    }\n    var service = request.service;\n    var bucketRegionCache = service.bucketRegionCache;\n    var cachedRegion = bucketRegionCache[bucket] || null;\n    if (cachedRegion && cachedRegion !== request.httpRequest.region) {\n      service.updateReqBucketRegion(request, cachedRegion);\n      done();\n    } else if (!service.dnsCompatibleBucketName(bucket)) {\n      service.updateReqBucketRegion(request, 'us-east-1');\n      if (bucketRegionCache[bucket] !== 'us-east-1') {\n        bucketRegionCache[bucket] = 'us-east-1';\n      }\n      done();\n    } else if (request.httpRequest.virtualHostedBucket) {\n      var getRegionReq = service.listObjects({\n        Bucket: bucket,\n        MaxKeys: 0\n      });\n      service.updateReqBucketRegion(getRegionReq, 'us-east-1');\n      getRegionReq._requestRegionForBucket = bucket;\n      getRegionReq.send(function () {\n        var region = service.bucketRegionCache[bucket] || null;\n        if (region && region !== request.httpRequest.region) {\n          service.updateReqBucketRegion(request, region);\n        }\n        done();\n      });\n    } else {\n      // DNS-compatible path-style\n      // (s3ForcePathStyle or bucket name with dot over https)\n      // Cannot obtain region information for this case\n      done();\n    }\n  },\n  /**\n   * Cache for bucket region.\n   *\n   * @api private\n   */\n  bucketRegionCache: {},\n  /**\n   * Clears bucket region cache.\n   *\n   * @api private\n   */\n  clearBucketRegionCache: function (buckets) {\n    var bucketRegionCache = this.bucketRegionCache;\n    if (!buckets) {\n      buckets = Object.keys(bucketRegionCache);\n    } else if (typeof buckets === 'string') {\n      buckets = [buckets];\n    }\n    for (var i = 0; i < buckets.length; i++) {\n      delete bucketRegionCache[buckets[i]];\n    }\n    return bucketRegionCache;\n  },\n  /**\n   * Corrects request region if bucket's cached region is different\n   *\n   * @api private\n   */\n  correctBucketRegionFromCache: function correctBucketRegionFromCache(req) {\n    var bucket = req.params.Bucket || null;\n    if (bucket) {\n      var service = req.service;\n      var requestRegion = req.httpRequest.region;\n      var cachedRegion = service.bucketRegionCache[bucket];\n      if (cachedRegion && cachedRegion !== requestRegion) {\n        service.updateReqBucketRegion(req, cachedRegion);\n      }\n    }\n  },\n  /**\n   * Extracts S3 specific request ids from the http response.\n   *\n   * @api private\n   */\n  extractRequestIds: function extractRequestIds(resp) {\n    var extendedRequestId = resp.httpResponse.headers ? resp.httpResponse.headers['x-amz-id-2'] : null;\n    var cfId = resp.httpResponse.headers ? resp.httpResponse.headers['x-amz-cf-id'] : null;\n    resp.extendedRequestId = extendedRequestId;\n    resp.cfId = cfId;\n    if (resp.error) {\n      resp.error.requestId = resp.requestId || null;\n      resp.error.extendedRequestId = extendedRequestId;\n      resp.error.cfId = cfId;\n    }\n  },\n  /**\n   * Get a pre-signed URL for a given operation name.\n   *\n   * @note You must ensure that you have static or previously resolved\n   *   credentials if you call this method synchronously (with no callback),\n   *   otherwise it may not properly sign the request. If you cannot guarantee\n   *   this (you are using an asynchronous credential provider, i.e., EC2\n   *   IAM roles), you should always call this method with an asynchronous\n   *   callback.\n   * @note Not all operation parameters are supported when using pre-signed\n   *   URLs. Certain parameters, such as `SSECustomerKey`, `ACL`, `Expires`,\n   *   `ContentLength`, or `Tagging` must be provided as headers when sending a\n   *   request. If you are using pre-signed URLs to upload from a browser and\n   *   need to use these fields, see {createPresignedPost}.\n   * @param operation [String] the name of the operation to call\n   * @param params [map] parameters to pass to the operation. See the given\n   *   operation for the expected operation parameters. In addition, you can\n   *   also pass the \"Expires\" parameter to inform S3 how long the URL should\n   *   work for.\n   * @option params Expires [Integer] (900) the number of seconds to expire\n   *   the pre-signed URL operation in. Defaults to 15 minutes.\n   * @param callback [Function] if a callback is provided, this function will\n   *   pass the URL as the second parameter (after the error parameter) to\n   *   the callback function.\n   * @return [String] if called synchronously (with no callback), returns the\n   *   signed URL.\n   * @return [null] nothing is returned if a callback is provided.\n   * @example Pre-signing a getObject operation (synchronously)\n   *   var params = {Bucket: 'bucket', Key: 'key'};\n   *   var url = s3.getSignedUrl('getObject', params);\n   *   console.log('The URL is', url);\n   * @example Pre-signing a putObject (asynchronously)\n   *   var params = {Bucket: 'bucket', Key: 'key'};\n   *   s3.getSignedUrl('putObject', params, function (err, url) {\n   *     console.log('The URL is', url);\n   *   });\n   * @example Pre-signing a putObject operation with a specific payload\n   *   var params = {Bucket: 'bucket', Key: 'key', Body: 'body'};\n   *   var url = s3.getSignedUrl('putObject', params);\n   *   console.log('The URL is', url);\n   * @example Passing in a 1-minute expiry time for a pre-signed URL\n   *   var params = {Bucket: 'bucket', Key: 'key', Expires: 60};\n   *   var url = s3.getSignedUrl('getObject', params);\n   *   console.log('The URL is', url); // expires in 60 seconds\n   */\n  getSignedUrl: function getSignedUrl(operation, params, callback) {\n    params = AWS.util.copy(params || {});\n    var expires = params.Expires || 900;\n    delete params.Expires; // we can't validate this\n    var request = this.makeRequest(operation, params);\n    return request.presign(expires, callback);\n  },\n  /**\n   * Get a pre-signed POST policy to support uploading to S3 directly from an\n   * HTML form.\n   *\n   * @param params [map]\n   * @option params Bucket [String]     The bucket to which the post should be\n   *                                    uploaded\n   * @option params Expires [Integer]   (3600) The number of seconds for which\n   *                                    the presigned policy should be valid.\n   * @option params Conditions [Array]  An array of conditions that must be met\n   *                                    for the presigned policy to allow the\n   *                                    upload. This can include required tags,\n   *                                    the accepted range for content lengths,\n   *                                    etc.\n   * @see http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTConstructPolicy.html\n   * @option params Fields [map]        Fields to include in the form. All\n   *                                    values passed in as fields will be\n   *                                    signed as exact match conditions.\n   * @param callback [Function]\n   *\n   * @note All fields passed in when creating presigned post data will be signed\n   *   as exact match conditions. Any fields that will be interpolated by S3\n   *   must be added to the fields hash after signing, and an appropriate\n   *   condition for such fields must be explicitly added to the Conditions\n   *   array passed to this function before signing.\n   *\n   * @example Presiging post data with a known key\n   *   var params = {\n   *     Bucket: 'bucket',\n   *     Fields: {\n   *       key: 'key'\n   *     }\n   *   };\n   *   s3.createPresignedPost(params, function(err, data) {\n   *     if (err) {\n   *       console.error('Presigning post data encountered an error', err);\n   *     } else {\n   *       console.log('The post data is', data);\n   *     }\n   *   });\n   *\n   * @example Presigning post data with an interpolated key\n   *   var params = {\n   *     Bucket: 'bucket',\n   *     Conditions: [\n   *       ['starts-with', '$key', 'path/to/uploads/']\n   *     ]\n   *   };\n   *   s3.createPresignedPost(params, function(err, data) {\n   *     if (err) {\n   *       console.error('Presigning post data encountered an error', err);\n   *     } else {\n   *       data.Fields.key = 'path/to/uploads/${filename}';\n   *       console.log('The post data is', data);\n   *     }\n   *   });\n   *\n   * @note You must ensure that you have static or previously resolved\n   *   credentials if you call this method synchronously (with no callback),\n   *   otherwise it may not properly sign the request. If you cannot guarantee\n   *   this (you are using an asynchronous credential provider, i.e., EC2\n   *   IAM roles), you should always call this method with an asynchronous\n   *   callback.\n   *\n   * @return [map]  If called synchronously (with no callback), returns a hash\n   *                with the url to set as the form action and a hash of fields\n   *                to include in the form.\n   * @return [null] Nothing is returned if a callback is provided.\n   *\n   * @callback callback function (err, data)\n   *  @param err [Error] the error object returned from the policy signer\n   *  @param data [map] The data necessary to construct an HTML form\n   *  @param data.url [String] The URL to use as the action of the form\n   *  @param data.fields [map] A hash of fields that must be included in the\n   *                           form for the upload to succeed. This hash will\n   *                           include the signed POST policy, your access key\n   *                           ID and security token (if present), etc. These\n   *                           may be safely included as input elements of type\n   *                           'hidden.'\n   */\n  createPresignedPost: function createPresignedPost(params, callback) {\n    if (typeof params === 'function' && callback === undefined) {\n      callback = params;\n      params = null;\n    }\n    params = AWS.util.copy(params || {});\n    var boundParams = this.config.params || {};\n    var bucket = params.Bucket || boundParams.Bucket,\n      self = this,\n      config = this.config,\n      endpoint = AWS.util.copy(this.endpoint);\n    if (!config.s3BucketEndpoint) {\n      endpoint.pathname = '/' + bucket;\n    }\n    function finalizePost() {\n      return {\n        url: AWS.util.urlFormat(endpoint),\n        fields: self.preparePostFields(config.credentials, config.region, bucket, params.Fields, params.Conditions, params.Expires)\n      };\n    }\n    if (callback) {\n      config.getCredentials(function (err) {\n        if (err) {\n          callback(err);\n        }\n        callback(null, finalizePost());\n      });\n    } else {\n      return finalizePost();\n    }\n  },\n  /**\n   * @api private\n   */\n  preparePostFields: function preparePostFields(credentials, region, bucket, fields, conditions, expiresInSeconds) {\n    var now = AWS.util.date.getDate();\n    if (!credentials || !region || !bucket) {\n      throw new Error('Unable to create a POST object policy without a bucket,' + ' region, and credentials');\n    }\n    fields = AWS.util.copy(fields || {});\n    conditions = (conditions || []).slice(0);\n    expiresInSeconds = expiresInSeconds || 3600;\n    var signingDate = AWS.util.date.iso8601(now).replace(/[:\\-]|\\.\\d{3}/g, '');\n    var shortDate = signingDate.substr(0, 8);\n    var scope = v4Credentials.createScope(shortDate, region, 's3');\n    var credential = credentials.accessKeyId + '/' + scope;\n    fields['bucket'] = bucket;\n    fields['X-Amz-Algorithm'] = 'AWS4-HMAC-SHA256';\n    fields['X-Amz-Credential'] = credential;\n    fields['X-Amz-Date'] = signingDate;\n    if (credentials.sessionToken) {\n      fields['X-Amz-Security-Token'] = credentials.sessionToken;\n    }\n    for (var field in fields) {\n      if (fields.hasOwnProperty(field)) {\n        var condition = {};\n        condition[field] = fields[field];\n        conditions.push(condition);\n      }\n    }\n    fields.Policy = this.preparePostPolicy(new Date(now.valueOf() + expiresInSeconds * 1000), conditions);\n    fields['X-Amz-Signature'] = AWS.util.crypto.hmac(v4Credentials.getSigningKey(credentials, shortDate, region, 's3', true), fields.Policy, 'hex');\n    return fields;\n  },\n  /**\n   * @api private\n   */\n  preparePostPolicy: function preparePostPolicy(expiration, conditions) {\n    return AWS.util.base64.encode(JSON.stringify({\n      expiration: AWS.util.date.iso8601(expiration),\n      conditions: conditions\n    }));\n  },\n  /**\n   * @api private\n   */\n  prepareSignedUrl: function prepareSignedUrl(request) {\n    request.addListener('validate', request.service.noPresignedContentLength);\n    request.removeListener('build', request.service.addContentType);\n    if (!request.params.Body) {\n      // no Content-MD5/SHA-256 if body is not provided\n      request.removeListener('build', request.service.computeContentMd5);\n    } else {\n      request.addListener('afterBuild', AWS.EventListeners.Core.COMPUTE_SHA256);\n    }\n  },\n  /**\n   * @api private\n   * @param request\n   */\n  disableBodySigning: function disableBodySigning(request) {\n    var headers = request.httpRequest.headers;\n    // Add the header to anything that isn't a presigned url, unless that presigned url had a body defined\n    if (!Object.prototype.hasOwnProperty.call(headers, 'presigned-expires')) {\n      headers['X-Amz-Content-Sha256'] = 'UNSIGNED-PAYLOAD';\n    }\n  },\n  /**\n   * @api private\n   */\n  noPresignedContentLength: function noPresignedContentLength(request) {\n    if (request.params.ContentLength !== undefined) {\n      throw AWS.util.error(new Error(), {\n        code: 'UnexpectedParameter',\n        message: 'ContentLength is not supported in pre-signed URLs.'\n      });\n    }\n  },\n  createBucket: function createBucket(params, callback) {\n    // When creating a bucket *outside* the classic region, the location\n    // constraint must be set for the bucket and it must match the endpoint.\n    // This chunk of code will set the location constraint param based\n    // on the region (when possible), but it will not override a passed-in\n    // location constraint.\n    if (typeof params === 'function' || !params) {\n      callback = callback || params;\n      params = {};\n    }\n    var hostname = this.endpoint.hostname;\n    if (hostname !== this.api.globalEndpoint && !params.CreateBucketConfiguration) {\n      params.CreateBucketConfiguration = {\n        LocationConstraint: this.config.region\n      };\n    }\n    return this.makeRequest('createBucket', params, callback);\n  },\n  /**\n   * @see AWS.S3.ManagedUpload\n   * @overload upload(params = {}, [options], [callback])\n   *   Uploads an arbitrarily sized buffer, blob, or stream, using intelligent\n   *   concurrent handling of parts if the payload is large enough. You can\n   *   configure the concurrent queue size by setting `options`. Note that this\n   *   is the only operation for which the SDK can retry requests with stream\n   *   bodies.\n   *\n   *   @param (see AWS.S3.putObject)\n   *   @option (see AWS.S3.ManagedUpload.constructor)\n   *   @return [AWS.S3.ManagedUpload] the managed upload object that can call\n   *     `send()` or track progress.\n   *   @example Uploading a stream object\n   *     var params = {Bucket: 'bucket', Key: 'key', Body: stream};\n   *     s3.upload(params, function(err, data) {\n   *       console.log(err, data);\n   *     });\n   *   @example Uploading a stream with concurrency of 1 and partSize of 10mb\n   *     var params = {Bucket: 'bucket', Key: 'key', Body: stream};\n   *     var options = {partSize: 10 * 1024 * 1024, queueSize: 1};\n   *     s3.upload(params, options, function(err, data) {\n   *       console.log(err, data);\n   *     });\n   * @callback callback function(err, data)\n   *   @param err [Error] an error or null if no error occurred.\n   *   @param data [map] The response data from the successful upload:\n   *   @param data.Location [String] the URL of the uploaded object\n   *   @param data.ETag [String] the ETag of the uploaded object\n   *   @param data.Bucket [String]  the bucket to which the object was uploaded\n   *   @param data.Key [String] the key to which the object was uploaded\n   */\n  upload: function upload(params, options, callback) {\n    if (typeof options === 'function' && callback === undefined) {\n      callback = options;\n      options = null;\n    }\n    options = options || {};\n    options = AWS.util.merge(options || {}, {\n      service: this,\n      params: params\n    });\n    var uploader = new AWS.S3.ManagedUpload(options);\n    if (typeof callback === 'function') uploader.send(callback);\n    return uploader;\n  }\n});","map":{"version":3,"names":["AWS","require","v4Credentials","operationsWith200StatusCodeError","regionRedirectErrorCodes","util","update","S3","prototype","getSignerClass","request","defaultApiVersion","api","signatureVersion","userDefinedVersion","_originalConfig","regionDefinedVersion","config","isPresigned","Signers","RequestSigner","getVersion","validateService","msg","messages","region","endpoint","s3BucketEndpoint","push","length","join","error","Error","name","message","shouldDisableBodySigning","signerClass","s3DisableBodySigning","V4","httpRequest","protocol","setupRequestListeners","addListener","validateScheme","validateBucketEndpoint","correctBucketRegionFromCache","addContentType","populateURI","computeContentMd5","computeSseCustomerKeyMd5","addExpect100Continue","removeListener","EventListeners","Core","VALIDATE_REGION","extractError","onAsync","requestBucketRegion","extractData","hoistPayloadMember","prepareSignedUrl","isBrowser","reqRegionForNetworkingError","COMPUTE_SHA256","disableBodySigning","req","params","scheme","sensitive","SSECustomerKey","CopySourceSSECustomerKey","code","Bucket","service","isValidAccelerateOperation","operation","invalidOperations","indexOf","b","pathStyleBucketName","useAccelerateEndpoint","useDualstack","hostname","port","host","virtualHostedBucket","removeVirtualHostedBucketFromPath","bucket","path","replace","RegExp","len","headers","isNode","method","contentType","body","match","charset","replaceFn","_","prefix","charsetName","toUpperCase","computableChecksumOperations","putBucketCors","putBucketLifecycle","putBucketLifecycleConfiguration","putBucketTagging","deleteObjects","putBucketReplication","willComputeChecksums","computeChecksums","Buffer","isBuffer","rules","operations","input","members","Object","hasOwnProperty","call","ContentMD5","required","md5","crypto","keys","each","key","header","value","bucketName","s3ForcePathStyle","dnsCompatibleBucketName","sslEnabled","domain","ipAddress","dots","successfulResponse","resp","httpResponse","toString","statusCode","retryableError","_requestRegionForBucket","bucketRegionCache","updateReqBucketRegion","_super","Service","s3Config","newConfig","copy","Host","_asm","currentState","data","LocationConstraint","clearBucketRegionCache","createBucketConfiguration","CreateBucketConfiguration","extractRequestIds","codes","cachedRegion","XML","Parser","parse","Region","Code","Message","done","reqOperation","reqParams","MaxKeys","regionReq","send","getRegionReq","listObjects","buckets","i","requestRegion","extendedRequestId","cfId","requestId","getSignedUrl","callback","expires","Expires","makeRequest","presign","createPresignedPost","undefined","boundParams","self","pathname","finalizePost","url","urlFormat","fields","preparePostFields","credentials","Fields","Conditions","getCredentials","err","conditions","expiresInSeconds","now","date","getDate","slice","signingDate","iso8601","shortDate","substr","scope","createScope","credential","accessKeyId","sessionToken","field","condition","Policy","preparePostPolicy","Date","valueOf","hmac","getSigningKey","expiration","base64","encode","JSON","stringify","noPresignedContentLength","Body","ContentLength","createBucket","globalEndpoint","upload","options","merge","uploader","ManagedUpload"],"sources":["/Users/luminosity/Desktop/Fovus/node_modules/aws-sdk/lib/services/s3.js"],"sourcesContent":["var AWS = require('../core');\nvar v4Credentials = require('../signers/v4_credentials');\n\n// Pull in managed upload extension\nrequire('../s3/managed_upload');\n\n/**\n * @api private\n */\nvar operationsWith200StatusCodeError = {\n  'completeMultipartUpload': true,\n  'copyObject': true,\n  'uploadPartCopy': true\n};\n\n/**\n * @api private\n */\n var regionRedirectErrorCodes = [\n  'AuthorizationHeaderMalformed', // non-head operations on virtual-hosted global bucket endpoints\n  'BadRequest', // head operations on virtual-hosted global bucket endpoints\n  'PermanentRedirect', // non-head operations on path-style or regional endpoints\n  301 // head operations on path-style or regional endpoints\n ];\n\nAWS.util.update(AWS.S3.prototype, {\n  /**\n   * @api private\n   */\n  getSignerClass: function getSignerClass(request) {\n    var defaultApiVersion = this.api.signatureVersion;\n    var userDefinedVersion = this._originalConfig ? this._originalConfig.signatureVersion : null;\n    var regionDefinedVersion = this.config.signatureVersion;\n    var isPresigned = request ? request.isPresigned() : false;\n    /*\n      1) User defined version specified:\n        a) always return user defined version\n      2) No user defined version specified:\n        a) default to lowest version the region supports\n    */\n    if (userDefinedVersion) {\n      userDefinedVersion = userDefinedVersion === 'v2' ? 's3' : userDefinedVersion;\n      return AWS.Signers.RequestSigner.getVersion(userDefinedVersion);\n    }\n    if (regionDefinedVersion) {\n      defaultApiVersion = regionDefinedVersion;\n    }\n\n    return AWS.Signers.RequestSigner.getVersion(defaultApiVersion);\n  },\n\n  /**\n   * @api private\n   */\n  validateService: function validateService() {\n    var msg;\n    var messages = [];\n\n    // default to us-east-1 when no region is provided\n    if (!this.config.region) this.config.region = 'us-east-1';\n\n    if (!this.config.endpoint && this.config.s3BucketEndpoint) {\n      messages.push('An endpoint must be provided when configuring ' +\n                    '`s3BucketEndpoint` to true.');\n    }\n    if (messages.length === 1) {\n      msg = messages[0];\n    } else if (messages.length > 1) {\n      msg = 'Multiple configuration errors:\\n' + messages.join('\\n');\n    }\n    if (msg) {\n      throw AWS.util.error(new Error(),\n        {name: 'InvalidEndpoint', message: msg});\n    }\n  },\n\n  /**\n   * @api private\n   */\n  shouldDisableBodySigning: function shouldDisableBodySigning(request) {\n    var signerClass = this.getSignerClass();\n    if (this.config.s3DisableBodySigning === true && signerClass === AWS.Signers.V4\n        && request.httpRequest.endpoint.protocol === 'https:') {\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * @api private\n   */\n  setupRequestListeners: function setupRequestListeners(request) {\n    request.addListener('validate', this.validateScheme);\n    request.addListener('validate', this.validateBucketEndpoint);\n    request.addListener('validate', this.correctBucketRegionFromCache);\n    request.addListener('build', this.addContentType);\n    request.addListener('build', this.populateURI);\n    request.addListener('build', this.computeContentMd5);\n    request.addListener('build', this.computeSseCustomerKeyMd5);\n    request.addListener('afterBuild', this.addExpect100Continue);\n    request.removeListener('validate',\n      AWS.EventListeners.Core.VALIDATE_REGION);\n    request.addListener('extractError', this.extractError);\n    request.onAsync('extractError', this.requestBucketRegion);\n    request.addListener('extractData', this.extractData);\n    request.addListener('extractData', AWS.util.hoistPayloadMember);\n    request.addListener('beforePresign', this.prepareSignedUrl);\n    if (AWS.util.isBrowser()) {\n      request.onAsync('retry', this.reqRegionForNetworkingError);\n    }\n    if (this.shouldDisableBodySigning(request))  {\n      request.removeListener('afterBuild', AWS.EventListeners.Core.COMPUTE_SHA256);\n      request.addListener('afterBuild', this.disableBodySigning);\n    }\n  },\n\n  /**\n   * @api private\n   */\n  validateScheme: function(req) {\n    var params = req.params,\n        scheme = req.httpRequest.endpoint.protocol,\n        sensitive = params.SSECustomerKey || params.CopySourceSSECustomerKey;\n    if (sensitive && scheme !== 'https:') {\n      var msg = 'Cannot send SSE keys over HTTP. Set \\'sslEnabled\\'' +\n        'to \\'true\\' in your configuration';\n      throw AWS.util.error(new Error(),\n        { code: 'ConfigError', message: msg });\n    }\n  },\n\n  /**\n   * @api private\n   */\n  validateBucketEndpoint: function(req) {\n    if (!req.params.Bucket && req.service.config.s3BucketEndpoint) {\n      var msg = 'Cannot send requests to root API with `s3BucketEndpoint` set.';\n      throw AWS.util.error(new Error(),\n        { code: 'ConfigError', message: msg });\n    }\n  },\n\n  /**\n   * @api private\n   */\n  isValidAccelerateOperation: function isValidAccelerateOperation(operation) {\n    var invalidOperations = [\n      'createBucket',\n      'deleteBucket',\n      'listBuckets'\n    ];\n    return invalidOperations.indexOf(operation) === -1;\n  },\n\n\n  /**\n   * S3 prefers dns-compatible bucket names to be moved from the uri path\n   * to the hostname as a sub-domain.  This is not possible, even for dns-compat\n   * buckets when using SSL and the bucket name contains a dot ('.').  The\n   * ssl wildcard certificate is only 1-level deep.\n   *\n   * @api private\n   */\n  populateURI: function populateURI(req) {\n    var httpRequest = req.httpRequest;\n    var b = req.params.Bucket;\n    var service = req.service;\n    var endpoint = httpRequest.endpoint;\n\n    if (b) {\n      if (!service.pathStyleBucketName(b)) {\n        if (service.config.useAccelerateEndpoint && service.isValidAccelerateOperation(req.operation)) {\n          if (service.config.useDualstack) {\n            endpoint.hostname = b + '.s3-accelerate.dualstack.amazonaws.com';\n          } else {\n            endpoint.hostname = b + '.s3-accelerate.amazonaws.com';\n          }\n        } else if (!service.config.s3BucketEndpoint) {\n          endpoint.hostname =\n            b + '.' + endpoint.hostname;\n        }\n\n        var port = endpoint.port;\n        if (port !== 80 && port !== 443) {\n          endpoint.host = endpoint.hostname + ':' +\n            endpoint.port;\n        } else {\n          endpoint.host = endpoint.hostname;\n        }\n\n        httpRequest.virtualHostedBucket = b; // needed for signing the request\n        service.removeVirtualHostedBucketFromPath(req);\n      }\n    }\n  },\n\n  /**\n   * Takes the bucket name out of the path if bucket is virtual-hosted\n   *\n   * @api private\n   */\n  removeVirtualHostedBucketFromPath: function removeVirtualHostedBucketFromPath(req) {\n    var httpRequest = req.httpRequest;\n    var bucket = httpRequest.virtualHostedBucket;\n    if (bucket && httpRequest.path) {\n      httpRequest.path = httpRequest.path.replace(new RegExp('/' + bucket), '');\n      if (httpRequest.path[0] !== '/') {\n        httpRequest.path = '/' + httpRequest.path;\n      }\n    }\n  },\n\n  /**\n   * Adds Expect: 100-continue header if payload is greater-or-equal 1MB\n   * @api private\n   */\n  addExpect100Continue: function addExpect100Continue(req) {\n    var len = req.httpRequest.headers['Content-Length'];\n    if (AWS.util.isNode() && len >= 1024 * 1024) {\n      req.httpRequest.headers['Expect'] = '100-continue';\n    }\n  },\n\n  /**\n   * Adds a default content type if none is supplied.\n   *\n   * @api private\n   */\n  addContentType: function addContentType(req) {\n    var httpRequest = req.httpRequest;\n    if (httpRequest.method === 'GET' || httpRequest.method === 'HEAD') {\n      // Content-Type is not set in GET/HEAD requests\n      delete httpRequest.headers['Content-Type'];\n      return;\n    }\n\n    if (!httpRequest.headers['Content-Type']) { // always have a Content-Type\n      httpRequest.headers['Content-Type'] = 'application/octet-stream';\n    }\n\n    var contentType = httpRequest.headers['Content-Type'];\n    if (AWS.util.isBrowser()) {\n      if (typeof httpRequest.body === 'string' && !contentType.match(/;\\s*charset=/)) {\n        var charset = '; charset=UTF-8';\n        httpRequest.headers['Content-Type'] += charset;\n      } else {\n        var replaceFn = function(_, prefix, charsetName) {\n          return prefix + charsetName.toUpperCase();\n        };\n\n        httpRequest.headers['Content-Type'] =\n          contentType.replace(/(;\\s*charset=)(.+)$/, replaceFn);\n      }\n    }\n  },\n\n  /**\n   * @api private\n   */\n  computableChecksumOperations: {\n    putBucketCors: true,\n    putBucketLifecycle: true,\n    putBucketLifecycleConfiguration: true,\n    putBucketTagging: true,\n    deleteObjects: true,\n    putBucketReplication: true\n  },\n\n  /**\n   * Checks whether checksums should be computed for the request.\n   * If the request requires checksums to be computed, this will always\n   * return true, otherwise it depends on whether {AWS.Config.computeChecksums}\n   * is set.\n   *\n   * @param req [AWS.Request] the request to check against\n   * @return [Boolean] whether to compute checksums for a request.\n   * @api private\n   */\n  willComputeChecksums: function willComputeChecksums(req) {\n    if (this.computableChecksumOperations[req.operation]) return true;\n    if (!this.config.computeChecksums) return false;\n\n    // TODO: compute checksums for Stream objects\n    if (!AWS.util.Buffer.isBuffer(req.httpRequest.body) &&\n        typeof req.httpRequest.body !== 'string') {\n      return false;\n    }\n\n    var rules = req.service.api.operations[req.operation].input.members;\n\n    // Sha256 signing disabled, and not a presigned url\n    if (req.service.shouldDisableBodySigning(req) && !Object.prototype.hasOwnProperty.call(req.httpRequest.headers, 'presigned-expires')) {\n      if (rules.ContentMD5 && !req.params.ContentMD5) {\n        return true;\n      }\n    }\n\n    // V4 signer uses SHA256 signatures so only compute MD5 if it is required\n    if (req.service.getSignerClass(req) === AWS.Signers.V4) {\n      if (rules.ContentMD5 && !rules.ContentMD5.required) return false;\n    }\n\n    if (rules.ContentMD5 && !req.params.ContentMD5) return true;\n  },\n\n  /**\n   * A listener that computes the Content-MD5 and sets it in the header.\n   * @see AWS.S3.willComputeChecksums\n   * @api private\n   */\n  computeContentMd5: function computeContentMd5(req) {\n    if (req.service.willComputeChecksums(req)) {\n      var md5 = AWS.util.crypto.md5(req.httpRequest.body, 'base64');\n      req.httpRequest.headers['Content-MD5'] = md5;\n    }\n  },\n\n  /**\n   * @api private\n   */\n  computeSseCustomerKeyMd5: function computeSseCustomerKeyMd5(req) {\n    var keys = {\n      SSECustomerKey: 'x-amz-server-side-encryption-customer-key-MD5',\n      CopySourceSSECustomerKey: 'x-amz-copy-source-server-side-encryption-customer-key-MD5'\n    };\n    AWS.util.each(keys, function(key, header) {\n      if (req.params[key]) {\n        var value = AWS.util.crypto.md5(req.params[key], 'base64');\n        req.httpRequest.headers[header] = value;\n      }\n    });\n  },\n\n  /**\n   * Returns true if the bucket name should be left in the URI path for\n   * a request to S3.  This function takes into account the current\n   * endpoint protocol (e.g. http or https).\n   *\n   * @api private\n   */\n  pathStyleBucketName: function pathStyleBucketName(bucketName) {\n    // user can force path style requests via the configuration\n    if (this.config.s3ForcePathStyle) return true;\n    if (this.config.s3BucketEndpoint) return false;\n\n    if (this.dnsCompatibleBucketName(bucketName)) {\n      return (this.config.sslEnabled && bucketName.match(/\\./)) ? true : false;\n    } else {\n      return true; // not dns compatible names must always use path style\n    }\n  },\n\n  /**\n   * Returns true if the bucket name is DNS compatible.  Buckets created\n   * outside of the classic region MUST be DNS compatible.\n   *\n   * @api private\n   */\n  dnsCompatibleBucketName: function dnsCompatibleBucketName(bucketName) {\n    var b = bucketName;\n    var domain = new RegExp(/^[a-z0-9][a-z0-9\\.\\-]{1,61}[a-z0-9]$/);\n    var ipAddress = new RegExp(/(\\d+\\.){3}\\d+/);\n    var dots = new RegExp(/\\.\\./);\n    return (b.match(domain) && !b.match(ipAddress) && !b.match(dots)) ? true : false;\n  },\n\n  /**\n   * @return [Boolean] whether response contains an error\n   * @api private\n   */\n  successfulResponse: function successfulResponse(resp) {\n    var req = resp.request;\n    var httpResponse = resp.httpResponse;\n    if (operationsWith200StatusCodeError[req.operation] &&\n        httpResponse.body.toString().match('<Error>')) {\n      return false;\n    } else {\n      return httpResponse.statusCode < 300;\n    }\n  },\n\n  /**\n   * @return [Boolean] whether the error can be retried\n   * @api private\n   */\n  retryableError: function retryableError(error, request) {\n    if (operationsWith200StatusCodeError[request.operation] &&\n        error.statusCode === 200) {\n      return true;\n    } else if (request._requestRegionForBucket &&\n        request.service.bucketRegionCache[request._requestRegionForBucket]) {\n      return false;\n    } else if (error && error.code === 'RequestTimeout') {\n      return true;\n    } else if (error &&\n        regionRedirectErrorCodes.indexOf(error.code) != -1 &&\n        error.region && error.region != request.httpRequest.region) {\n      request.httpRequest.region = error.region;\n      if (error.statusCode === 301) {\n        request.service.updateReqBucketRegion(request);\n      }\n      return true;\n    } else {\n      var _super = AWS.Service.prototype.retryableError;\n      return _super.call(this, error, request);\n    }\n  },\n\n  /**\n   * Updates httpRequest with region. If region is not provided, then\n   * the httpRequest will be updated based on httpRequest.region\n   *\n   * @api private\n   */\n  updateReqBucketRegion: function updateReqBucketRegion(request, region) {\n    var httpRequest = request.httpRequest;\n    if (typeof region === 'string' && region.length) {\n      httpRequest.region = region;\n    }\n    if (!httpRequest.endpoint.host.match(/s3(?!-accelerate).*\\.amazonaws\\.com$/)) {\n      return;\n    }\n    var service = request.service;\n    var s3Config = service.config;\n    var s3BucketEndpoint = s3Config.s3BucketEndpoint;\n    if (s3BucketEndpoint) {\n      delete s3Config.s3BucketEndpoint;\n    }\n    var newConfig = AWS.util.copy(s3Config);\n    delete newConfig.endpoint;\n    newConfig.region = httpRequest.region;\n\n    httpRequest.endpoint = (new AWS.S3(newConfig)).endpoint;\n    service.populateURI(request);\n    s3Config.s3BucketEndpoint = s3BucketEndpoint;\n    httpRequest.headers.Host = httpRequest.endpoint.host;\n\n    if (request._asm.currentState === 'validate') {\n      request.removeListener('build', service.populateURI);\n      request.addListener('build', service.removeVirtualHostedBucketFromPath);\n    }\n  },\n\n  /**\n   * Provides a specialized parser for getBucketLocation -- all other\n   * operations are parsed by the super class.\n   *\n   * @api private\n   */\n  extractData: function extractData(resp) {\n    var req = resp.request;\n    if (req.operation === 'getBucketLocation') {\n      var match = resp.httpResponse.body.toString().match(/>(.+)<\\/Location/);\n      delete resp.data['_'];\n      if (match) {\n        resp.data.LocationConstraint = match[1];\n      } else {\n        resp.data.LocationConstraint = '';\n      }\n    }\n    var bucket = req.params.Bucket || null;\n    if (req.operation === 'deleteBucket' && typeof bucket === 'string' && !resp.error) {\n      req.service.clearBucketRegionCache(bucket);\n    } else {\n      var headers = resp.httpResponse.headers || {};\n      var region = headers['x-amz-bucket-region'] || null;\n      if (!region && req.operation === 'createBucket' && !resp.error) {\n        var createBucketConfiguration = req.params.CreateBucketConfiguration;\n        if (!createBucketConfiguration) {\n          region = 'us-east-1';\n        } else if (createBucketConfiguration.LocationConstraint === 'EU') {\n          region = 'eu-west-1';\n        } else {\n          region = createBucketConfiguration.LocationConstraint;\n        }\n      }\n      if (region) {\n          if (bucket && region !== req.service.bucketRegionCache[bucket]) {\n            req.service.bucketRegionCache[bucket] = region;\n          }\n      }\n    }\n    req.service.extractRequestIds(resp);\n  },\n\n  /**\n   * Extracts an error object from the http response.\n   *\n   * @api private\n   */\n  extractError: function extractError(resp) {\n    var codes = {\n      304: 'NotModified',\n      403: 'Forbidden',\n      400: 'BadRequest',\n      404: 'NotFound'\n    };\n\n    var req = resp.request;\n    var code = resp.httpResponse.statusCode;\n    var body = resp.httpResponse.body || '';\n\n    var headers = resp.httpResponse.headers || {};\n    var region = headers['x-amz-bucket-region'] || null;\n    var bucket = req.params.Bucket || null;\n    var bucketRegionCache = req.service.bucketRegionCache;\n    if (region && bucket && region !== bucketRegionCache[bucket]) {\n      bucketRegionCache[bucket] = region;\n    }\n\n    var cachedRegion;\n    if (codes[code] && body.length === 0) {\n      if (bucket && !region) {\n        cachedRegion = bucketRegionCache[bucket] || null;\n        if (cachedRegion !== req.httpRequest.region) {\n          region = cachedRegion;\n        }\n      }\n      resp.error = AWS.util.error(new Error(), {\n        code: codes[code],\n        message: null,\n        region: region\n      });\n    } else {\n      var data = new AWS.XML.Parser().parse(body.toString());\n\n      if (data.Region && !region) {\n        region = data.Region;\n        if (bucket && region !== bucketRegionCache[bucket]) {\n          bucketRegionCache[bucket] = region;\n        }\n      } else if (bucket && !region && !data.Region) {\n        cachedRegion = bucketRegionCache[bucket] || null;\n        if (cachedRegion !== req.httpRequest.region) {\n          region = cachedRegion;\n        }\n      }\n\n      resp.error = AWS.util.error(new Error(), {\n        code: data.Code || code,\n        message: data.Message || null,\n        region: region\n      });\n    }\n    req.service.extractRequestIds(resp);\n  },\n\n  /**\n   * If region was not obtained synchronously, then send async request\n   * to get bucket region for errors resulting from wrong region.\n   *\n   * @api private\n   */\n  requestBucketRegion: function requestBucketRegion(resp, done) {\n    var error = resp.error;\n    var req = resp.request;\n    var bucket = req.params.Bucket || null;\n\n    if (!error || !bucket || error.region || req.operation === 'listObjects' ||\n        (AWS.util.isNode() && req.operation === 'headBucket') ||\n        (error.statusCode === 400 && req.operation !== 'headObject') ||\n        regionRedirectErrorCodes.indexOf(error.code) === -1) {\n      return done();\n    }\n    var reqOperation = AWS.util.isNode() ? 'headBucket' : 'listObjects';\n    var reqParams = {Bucket: bucket};\n    if (reqOperation === 'listObjects') reqParams.MaxKeys = 0;\n    var regionReq = req.service[reqOperation](reqParams);\n    regionReq._requestRegionForBucket = bucket;\n    regionReq.send(function() {\n      var region = req.service.bucketRegionCache[bucket] || null;\n      error.region = region;\n      done();\n    });\n  },\n\n   /**\n   * For browser only. If NetworkingError received, will attempt to obtain\n   * the bucket region.\n   *\n   * @api private\n   */\n   reqRegionForNetworkingError: function reqRegionForNetworkingError(resp, done) {\n    if (!AWS.util.isBrowser()) {\n      return done();\n    }\n    var error = resp.error;\n    var request = resp.request;\n    var bucket = request.params.Bucket;\n    if (!error || error.code !== 'NetworkingError' || !bucket ||\n        request.httpRequest.region === 'us-east-1') {\n      return done();\n    }\n    var service = request.service;\n    var bucketRegionCache = service.bucketRegionCache;\n    var cachedRegion = bucketRegionCache[bucket] || null;\n\n    if (cachedRegion && cachedRegion !== request.httpRequest.region) {\n      service.updateReqBucketRegion(request, cachedRegion);\n      done();\n    } else if (!service.dnsCompatibleBucketName(bucket)) {\n      service.updateReqBucketRegion(request, 'us-east-1');\n      if (bucketRegionCache[bucket] !== 'us-east-1') {\n        bucketRegionCache[bucket] = 'us-east-1';\n      }\n      done();\n    } else if (request.httpRequest.virtualHostedBucket) {\n      var getRegionReq = service.listObjects({Bucket: bucket, MaxKeys: 0});\n      service.updateReqBucketRegion(getRegionReq, 'us-east-1');\n      getRegionReq._requestRegionForBucket = bucket;\n\n      getRegionReq.send(function() {\n        var region = service.bucketRegionCache[bucket] || null;\n        if (region && region !== request.httpRequest.region) {\n          service.updateReqBucketRegion(request, region);\n        }\n        done();\n      });\n    } else {\n      // DNS-compatible path-style\n      // (s3ForcePathStyle or bucket name with dot over https)\n      // Cannot obtain region information for this case\n      done();\n    }\n   },\n\n  /**\n   * Cache for bucket region.\n   *\n   * @api private\n   */\n   bucketRegionCache: {},\n\n  /**\n   * Clears bucket region cache.\n   *\n   * @api private\n   */\n   clearBucketRegionCache: function(buckets) {\n    var bucketRegionCache = this.bucketRegionCache;\n    if (!buckets) {\n      buckets = Object.keys(bucketRegionCache);\n    } else if (typeof buckets === 'string') {\n      buckets = [buckets];\n    }\n    for (var i = 0; i < buckets.length; i++) {\n      delete bucketRegionCache[buckets[i]];\n    }\n    return bucketRegionCache;\n   },\n\n   /**\n    * Corrects request region if bucket's cached region is different\n    *\n    * @api private\n    */\n  correctBucketRegionFromCache: function correctBucketRegionFromCache(req) {\n    var bucket = req.params.Bucket || null;\n    if (bucket) {\n      var service = req.service;\n      var requestRegion = req.httpRequest.region;\n      var cachedRegion = service.bucketRegionCache[bucket];\n      if (cachedRegion && cachedRegion !== requestRegion) {\n        service.updateReqBucketRegion(req, cachedRegion);\n      }\n    }\n  },\n\n  /**\n   * Extracts S3 specific request ids from the http response.\n   *\n   * @api private\n   */\n  extractRequestIds: function extractRequestIds(resp) {\n    var extendedRequestId = resp.httpResponse.headers ? resp.httpResponse.headers['x-amz-id-2'] : null;\n    var cfId = resp.httpResponse.headers ? resp.httpResponse.headers['x-amz-cf-id'] : null;\n    resp.extendedRequestId = extendedRequestId;\n    resp.cfId = cfId;\n\n    if (resp.error) {\n      resp.error.requestId = resp.requestId || null;\n      resp.error.extendedRequestId = extendedRequestId;\n      resp.error.cfId = cfId;\n    }\n  },\n\n  /**\n   * Get a pre-signed URL for a given operation name.\n   *\n   * @note You must ensure that you have static or previously resolved\n   *   credentials if you call this method synchronously (with no callback),\n   *   otherwise it may not properly sign the request. If you cannot guarantee\n   *   this (you are using an asynchronous credential provider, i.e., EC2\n   *   IAM roles), you should always call this method with an asynchronous\n   *   callback.\n   * @note Not all operation parameters are supported when using pre-signed\n   *   URLs. Certain parameters, such as `SSECustomerKey`, `ACL`, `Expires`,\n   *   `ContentLength`, or `Tagging` must be provided as headers when sending a\n   *   request. If you are using pre-signed URLs to upload from a browser and\n   *   need to use these fields, see {createPresignedPost}.\n   * @param operation [String] the name of the operation to call\n   * @param params [map] parameters to pass to the operation. See the given\n   *   operation for the expected operation parameters. In addition, you can\n   *   also pass the \"Expires\" parameter to inform S3 how long the URL should\n   *   work for.\n   * @option params Expires [Integer] (900) the number of seconds to expire\n   *   the pre-signed URL operation in. Defaults to 15 minutes.\n   * @param callback [Function] if a callback is provided, this function will\n   *   pass the URL as the second parameter (after the error parameter) to\n   *   the callback function.\n   * @return [String] if called synchronously (with no callback), returns the\n   *   signed URL.\n   * @return [null] nothing is returned if a callback is provided.\n   * @example Pre-signing a getObject operation (synchronously)\n   *   var params = {Bucket: 'bucket', Key: 'key'};\n   *   var url = s3.getSignedUrl('getObject', params);\n   *   console.log('The URL is', url);\n   * @example Pre-signing a putObject (asynchronously)\n   *   var params = {Bucket: 'bucket', Key: 'key'};\n   *   s3.getSignedUrl('putObject', params, function (err, url) {\n   *     console.log('The URL is', url);\n   *   });\n   * @example Pre-signing a putObject operation with a specific payload\n   *   var params = {Bucket: 'bucket', Key: 'key', Body: 'body'};\n   *   var url = s3.getSignedUrl('putObject', params);\n   *   console.log('The URL is', url);\n   * @example Passing in a 1-minute expiry time for a pre-signed URL\n   *   var params = {Bucket: 'bucket', Key: 'key', Expires: 60};\n   *   var url = s3.getSignedUrl('getObject', params);\n   *   console.log('The URL is', url); // expires in 60 seconds\n   */\n  getSignedUrl: function getSignedUrl(operation, params, callback) {\n    params = AWS.util.copy(params || {});\n    var expires = params.Expires || 900;\n    delete params.Expires; // we can't validate this\n    var request = this.makeRequest(operation, params);\n    return request.presign(expires, callback);\n  },\n\n\n  /**\n   * Get a pre-signed POST policy to support uploading to S3 directly from an\n   * HTML form.\n   *\n   * @param params [map]\n   * @option params Bucket [String]     The bucket to which the post should be\n   *                                    uploaded\n   * @option params Expires [Integer]   (3600) The number of seconds for which\n   *                                    the presigned policy should be valid.\n   * @option params Conditions [Array]  An array of conditions that must be met\n   *                                    for the presigned policy to allow the\n   *                                    upload. This can include required tags,\n   *                                    the accepted range for content lengths,\n   *                                    etc.\n   * @see http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTConstructPolicy.html\n   * @option params Fields [map]        Fields to include in the form. All\n   *                                    values passed in as fields will be\n   *                                    signed as exact match conditions.\n   * @param callback [Function]\n   *\n   * @note All fields passed in when creating presigned post data will be signed\n   *   as exact match conditions. Any fields that will be interpolated by S3\n   *   must be added to the fields hash after signing, and an appropriate\n   *   condition for such fields must be explicitly added to the Conditions\n   *   array passed to this function before signing.\n   *\n   * @example Presiging post data with a known key\n   *   var params = {\n   *     Bucket: 'bucket',\n   *     Fields: {\n   *       key: 'key'\n   *     }\n   *   };\n   *   s3.createPresignedPost(params, function(err, data) {\n   *     if (err) {\n   *       console.error('Presigning post data encountered an error', err);\n   *     } else {\n   *       console.log('The post data is', data);\n   *     }\n   *   });\n   *\n   * @example Presigning post data with an interpolated key\n   *   var params = {\n   *     Bucket: 'bucket',\n   *     Conditions: [\n   *       ['starts-with', '$key', 'path/to/uploads/']\n   *     ]\n   *   };\n   *   s3.createPresignedPost(params, function(err, data) {\n   *     if (err) {\n   *       console.error('Presigning post data encountered an error', err);\n   *     } else {\n   *       data.Fields.key = 'path/to/uploads/${filename}';\n   *       console.log('The post data is', data);\n   *     }\n   *   });\n   *\n   * @note You must ensure that you have static or previously resolved\n   *   credentials if you call this method synchronously (with no callback),\n   *   otherwise it may not properly sign the request. If you cannot guarantee\n   *   this (you are using an asynchronous credential provider, i.e., EC2\n   *   IAM roles), you should always call this method with an asynchronous\n   *   callback.\n   *\n   * @return [map]  If called synchronously (with no callback), returns a hash\n   *                with the url to set as the form action and a hash of fields\n   *                to include in the form.\n   * @return [null] Nothing is returned if a callback is provided.\n   *\n   * @callback callback function (err, data)\n   *  @param err [Error] the error object returned from the policy signer\n   *  @param data [map] The data necessary to construct an HTML form\n   *  @param data.url [String] The URL to use as the action of the form\n   *  @param data.fields [map] A hash of fields that must be included in the\n   *                           form for the upload to succeed. This hash will\n   *                           include the signed POST policy, your access key\n   *                           ID and security token (if present), etc. These\n   *                           may be safely included as input elements of type\n   *                           'hidden.'\n   */\n  createPresignedPost: function createPresignedPost(params, callback) {\n    if (typeof params === 'function' && callback === undefined) {\n      callback = params;\n      params = null;\n    }\n\n    params = AWS.util.copy(params || {});\n    var boundParams = this.config.params || {};\n    var bucket = params.Bucket || boundParams.Bucket,\n      self = this,\n      config = this.config,\n      endpoint = AWS.util.copy(this.endpoint);\n    if (!config.s3BucketEndpoint) {\n      endpoint.pathname = '/' + bucket;\n    }\n\n    function finalizePost() {\n      return {\n        url: AWS.util.urlFormat(endpoint),\n        fields: self.preparePostFields(\n          config.credentials,\n          config.region,\n          bucket,\n          params.Fields,\n          params.Conditions,\n          params.Expires\n        )\n      };\n    }\n\n    if (callback) {\n      config.getCredentials(function (err) {\n        if (err) {\n          callback(err);\n        }\n\n        callback(null, finalizePost());\n      });\n    } else {\n      return finalizePost();\n    }\n  },\n\n  /**\n   * @api private\n   */\n  preparePostFields: function preparePostFields(\n    credentials,\n    region,\n    bucket,\n    fields,\n    conditions,\n    expiresInSeconds\n  ) {\n    var now = AWS.util.date.getDate();\n    if (!credentials || !region || !bucket) {\n      throw new Error('Unable to create a POST object policy without a bucket,'\n        + ' region, and credentials');\n    }\n    fields = AWS.util.copy(fields || {});\n    conditions = (conditions || []).slice(0);\n    expiresInSeconds = expiresInSeconds || 3600;\n\n    var signingDate = AWS.util.date.iso8601(now).replace(/[:\\-]|\\.\\d{3}/g, '');\n    var shortDate = signingDate.substr(0, 8);\n    var scope = v4Credentials.createScope(shortDate, region, 's3');\n    var credential = credentials.accessKeyId + '/' + scope;\n\n    fields['bucket'] = bucket;\n    fields['X-Amz-Algorithm'] = 'AWS4-HMAC-SHA256';\n    fields['X-Amz-Credential'] = credential;\n    fields['X-Amz-Date'] = signingDate;\n    if (credentials.sessionToken) {\n      fields['X-Amz-Security-Token'] = credentials.sessionToken;\n    }\n    for (var field in fields) {\n      if (fields.hasOwnProperty(field)) {\n        var condition = {};\n        condition[field] = fields[field];\n        conditions.push(condition);\n      }\n    }\n\n    fields.Policy = this.preparePostPolicy(\n      new Date(now.valueOf() + expiresInSeconds * 1000),\n      conditions\n    );\n    fields['X-Amz-Signature'] = AWS.util.crypto.hmac(\n      v4Credentials.getSigningKey(credentials, shortDate, region, 's3', true),\n      fields.Policy,\n      'hex'\n    );\n\n    return fields;\n  },\n\n  /**\n   * @api private\n   */\n  preparePostPolicy: function preparePostPolicy(expiration, conditions) {\n    return AWS.util.base64.encode(JSON.stringify({\n      expiration: AWS.util.date.iso8601(expiration),\n      conditions: conditions\n    }));\n  },\n\n  /**\n   * @api private\n   */\n  prepareSignedUrl: function prepareSignedUrl(request) {\n    request.addListener('validate', request.service.noPresignedContentLength);\n    request.removeListener('build', request.service.addContentType);\n    if (!request.params.Body) {\n      // no Content-MD5/SHA-256 if body is not provided\n      request.removeListener('build', request.service.computeContentMd5);\n    } else {\n      request.addListener('afterBuild', AWS.EventListeners.Core.COMPUTE_SHA256);\n    }\n  },\n\n  /**\n   * @api private\n   * @param request\n   */\n  disableBodySigning: function disableBodySigning(request) {\n    var headers = request.httpRequest.headers;\n    // Add the header to anything that isn't a presigned url, unless that presigned url had a body defined\n    if (!Object.prototype.hasOwnProperty.call(headers, 'presigned-expires')) {\n      headers['X-Amz-Content-Sha256'] = 'UNSIGNED-PAYLOAD';\n    }\n  },\n\n  /**\n   * @api private\n   */\n  noPresignedContentLength: function noPresignedContentLength(request) {\n    if (request.params.ContentLength !== undefined) {\n      throw AWS.util.error(new Error(), {code: 'UnexpectedParameter',\n        message: 'ContentLength is not supported in pre-signed URLs.'});\n    }\n  },\n\n  createBucket: function createBucket(params, callback) {\n    // When creating a bucket *outside* the classic region, the location\n    // constraint must be set for the bucket and it must match the endpoint.\n    // This chunk of code will set the location constraint param based\n    // on the region (when possible), but it will not override a passed-in\n    // location constraint.\n    if (typeof params === 'function' || !params) {\n      callback = callback || params;\n      params = {};\n    }\n    var hostname = this.endpoint.hostname;\n    if (hostname !== this.api.globalEndpoint && !params.CreateBucketConfiguration) {\n      params.CreateBucketConfiguration = { LocationConstraint: this.config.region };\n    }\n    return this.makeRequest('createBucket', params, callback);\n  },\n\n  /**\n   * @see AWS.S3.ManagedUpload\n   * @overload upload(params = {}, [options], [callback])\n   *   Uploads an arbitrarily sized buffer, blob, or stream, using intelligent\n   *   concurrent handling of parts if the payload is large enough. You can\n   *   configure the concurrent queue size by setting `options`. Note that this\n   *   is the only operation for which the SDK can retry requests with stream\n   *   bodies.\n   *\n   *   @param (see AWS.S3.putObject)\n   *   @option (see AWS.S3.ManagedUpload.constructor)\n   *   @return [AWS.S3.ManagedUpload] the managed upload object that can call\n   *     `send()` or track progress.\n   *   @example Uploading a stream object\n   *     var params = {Bucket: 'bucket', Key: 'key', Body: stream};\n   *     s3.upload(params, function(err, data) {\n   *       console.log(err, data);\n   *     });\n   *   @example Uploading a stream with concurrency of 1 and partSize of 10mb\n   *     var params = {Bucket: 'bucket', Key: 'key', Body: stream};\n   *     var options = {partSize: 10 * 1024 * 1024, queueSize: 1};\n   *     s3.upload(params, options, function(err, data) {\n   *       console.log(err, data);\n   *     });\n   * @callback callback function(err, data)\n   *   @param err [Error] an error or null if no error occurred.\n   *   @param data [map] The response data from the successful upload:\n   *   @param data.Location [String] the URL of the uploaded object\n   *   @param data.ETag [String] the ETag of the uploaded object\n   *   @param data.Bucket [String]  the bucket to which the object was uploaded\n   *   @param data.Key [String] the key to which the object was uploaded\n   */\n  upload: function upload(params, options, callback) {\n    if (typeof options === 'function' && callback === undefined) {\n      callback = options;\n      options = null;\n    }\n\n    options = options || {};\n    options = AWS.util.merge(options || {}, {service: this, params: params});\n\n    var uploader = new AWS.S3.ManagedUpload(options);\n    if (typeof callback === 'function') uploader.send(callback);\n    return uploader;\n  }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}